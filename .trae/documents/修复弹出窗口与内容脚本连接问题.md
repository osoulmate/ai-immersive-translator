# 修复弹出窗口与内容脚本连接问题

## 问题分析
错误信息："启动失败: Could not establish connection. Receiving end does not exist."

**根本原因**：当弹出窗口尝试向内容脚本发送消息时，内容脚本可能尚未加载完成或初始化，导致消息发送失败。

## 修复方案

### 1. 修改 popup.js 文件
- **添加错误处理机制**：在 `startTranslation`、`toggleTranslation`、`stopTranslation` 和 `translateSelectedText` 方法中添加错误处理
- **实现脚本注入回退**：当内容脚本未准备好时，使用 `chrome.scripting.executeScript` 注入内容脚本
- **优化错误提示**：提供更友好的错误提示，引导用户刷新页面或重试

### 2. 验证 content.js 文件
- **确认消息监听器设置**：确保 `setupMessageListener` 方法正确初始化
- **检查初始化流程**：验证内容脚本的初始化流程是否正确

### 3. 测试修复效果
- **测试不同场景**：在不同网页上测试翻译功能
- **验证错误处理**：测试内容脚本未准备好时的错误处理
- **确保功能正常**：验证翻译功能在各种情况下都能正常工作

## 技术要点
- 使用 `chrome.scripting.executeScript` 作为回退机制
- 实现更健壮的错误处理
- 确保内容脚本与弹出窗口之间的通信可靠
- 提供清晰的用户反馈

## 预期效果
- 消除"启动失败"错误
- 提高插件的可靠性
- 改善用户体验
- 确保翻译功能在各种情况下都能正常工作